<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minecraft Server Status</title>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

<header>
  <h1>Are we online?</h1>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="status.html">Server Status</a>
  <a href="gallery.html">Gallery</a>
  <a href="community.html">Community</a>
  <a href="about.html">About</a>
</nav>

<main>
  <div class="card">
    <h2>Server Status</h2>
    <p>Status: <span id="server-status">Loading...</span></p>
    <p>Players Online: <span id="player-count">0</span></p>

    <h3>Online Players</h3>
    <ul id="player-list">
      <li>Loading...</li>
    </ul>

    <button onclick="copyIP()">Copy Server IP</button>
  </div>
</main>

<footer>
  <p>&copy; 2025 Introduction Perfume Minecraft Server</p>
</footer>

<script>
const serverAddress = "introduction-perfume.gl.at.ply.gg";
const serverPort = 40238;

async function fetchServerStatus() {
  try {
    const response = await fetch(`https://api.mcsrvstat.us/bedrock/2/${serverAddress}:${serverPort}`);
    const data = await response.json();

    // Debug log the full API response
    console.log('API Response:', data);

    const statusEl = document.getElementById("server-status");
    const playerCountEl = document.getElementById("player-count");
    const playerListEl = document.getElementById("player-list");

    if(data.online) {
      statusEl.textContent = "Online";
      statusEl.className = "online";
      
      // For Bedrock, sometimes data.players is undefined or doesn't have 'list'
      let playerCount = 0;
      let players = [];

      // If players property exists
      if (data.players) {
        playerCount = data.players.online || 0;
        // For Bedrock: list may not exist, may be null, or may be an array
        if (Array.isArray(data.players.list)) {
          players = data.players.list;
        }
      }

      playerCountEl.textContent = playerCount;

      // Clear current list
      playerListEl.innerHTML = "";
      if(players.length === 0) {
        playerListEl.innerHTML = "<li>No players online</li>";
      } else {
        players.forEach(player => {
          const li = document.createElement("li");
          li.textContent = player;
          playerListEl.appendChild(li);
        });
      }

    } else {
      statusEl.textContent = "Offline";
      statusEl.className = "offline";
      playerCountEl.textContent = 0;
      playerListEl.innerHTML = "<li>Server is offline</li>";
    }

  } catch(err) {
    console.error(err);
    document.getElementById("server-status").textContent = "Error";
    document.getElementById("player-count").textContent = 0;
    document.getElementById("player-list").innerHTML = "<li>Error fetching data</li>";
  }
}

// Copy IP function
function copyIP() {
  navigator.clipboard.writeText(`${serverAddress}:${serverPort}`)
    .then(() => alert("Server IP copied!"))
    .catch(() => alert("Failed to copy IP."));
}

// Initial fetch
fetchServerStatus();

// Refresh every 15 seconds
setInterval(fetchServerStatus, 15000);
</script>

</body>
</html>
